---
# Role variables

# Versions

wso2am_effective_version: >-
  {{ (wso2am_version == "latest")
     | ternary(wso2am_latest_version, wso2am_version) }}

wso2am_installed_version: >-
  {{ ansible_local.wso2am.version | default("0") }}

# Official download variables

wso2am_official_download_host: https://github.com
wso2am_official_download_releases_path: /wso2/product-apim/releases
wso2am_official_download_releases_url: >-
  {{ wso2am_official_download_host
     + "/"
     + wso2am_official_download_releases_path }}
wso2am_official_download_path: >-
  {{ wso2am_official_download_releases_path
     + "/download/v"
     + wso2am_effective_version }}
wso2am_official_download_file:
  server: "wso2am-{{ wso2am_effective_version }}.zip"
  worker: "wso2am-analytics-{{ wso2am_effective_version }}.zip"
  dashboard: "wso2am-analytics-{{ wso2am_effective_version }}.zip"

# Indicate if install is required

wso2am_install_required: >-
  {{ wso2am_effective_version
     is not version((wso2am_installed_version | string | length > 0)
                     | ternary(wso2am_installed_version, "0"),
                     "==")
     and wso2am_state == "present" }}

# Packages

wso2am_pakages_os:
  all:
    all:
      java: present
      java-devel: present
      tar: present
      unzip: present
      rsync: present

# FIXME: Database drivers

wsoam_database_drivers:
  mysql:

    name:
  oracle:
    version: 12.2.0.1

    download_user: acme
    download_password: acme

# Paths

wso2am_systemd_service_dir: /lib/systemd/system

wso2am_keystore_path_map:
  server: "{{ wso2am_dir }}/repository/resources/security"
  worker: "{{ wso2am_dir }}/resources/security"
  dashboard: "{{ wso2am_dir }}/resources/security"

wso2am_deployment_path_map:
  server: "{{ wso2am_dir }}/repository/conf/deployment.toml"
  worker: "{{ wso2am_dir }}/conf/worker/deployment.yaml"
  dashboard: "{{ wso2am_dir }}/conf/dashboard/deployment.yaml"

# Databases

wso2am_mysql_databases: >-
  {{ wso2am_databases
     | selectattr("type", "in", ["mariadb", "mysql"])
     | selectattr("populate", "defined")
     | selectattr("populate", "equalto", true)
     | list }}

wso2am_oracle_databases: >-
  {{ wso2am_databases
     | selectattr("type", "in", ["oracle"])
     | selectattr("populate", "defined")
     | selectattr("populate", "equalto", true)
     | list }}
